---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

This report analyses the accompanying `activity.zip` file, which contains footstep data collected from a personal activity monitoring device at five minute intervals between October and November 2012.

## Loading and preprocessing the data

The following code loads the ggplot2 library required for plotting the graphs in this report, then extracts the `activity.zip` file and reads the resulting CSV file into memory.

```{r load_data}
# Load required libraries
require(ggplot2)

# Unzip the data and read it in.
unzip("activity.zip")
activity <- read.csv("activity.csv", stringsAsFactors = FALSE)

```


## What is mean total number of steps taken per day?

The following code summarises the footstep data, calculating the total number of steps on each day (ignoring missing values) and plots that data as a histogram. It also calculates the mean and median number of daily steps taken across all days.

```{r mean_per_day}
# Summarise the total number of footsteps by day.
totals <- aggregate(
    activity$steps, 
    list(Day = activity$date),
    sum, 
    na.rm = TRUE
)
mean_steps <- mean(totals$x)
median_steps <- median(totals$x)

# Plot a histogram of total steps each day.
hist(totals$x, main = "Histogram of total steps per day")

```

The mean number of steps taken per day was `r format(mean_steps, big.mark = ",")`. The median number of steps taken per day was `r format(median_steps, big.mark=",")`.


## What is the average daily activity pattern?



```{r mean_per_interval}

# Summarise the mean number of footsteps by interval number.
interval_means <- aggregate(
    activity$steps, 
    list(interval = activity$interval), 
    mean, 
    na.rm = TRUE
)

# Plot the interval number against the mean number of steps in that interval.
ggplot(data = interval_means, aes(x = interval, y = x)) + 
    geom_line() + 
    ylab("Mean steps") + 
    ggtitle("Mean steps at 5-minute intervals")

# Get the interval number with the greatest average number of footsteps.
max_row <- which(interval_means$x == max(interval_means$x))
max_interval <- interval_means[max_row, "Interval"]

```


## Imputing missing values
```{r missing_values}
num_nas <- sum(is.na(activity$steps))

get_interval_mean <- function(interval) { interval_means[interval_means$Interval == interval, "x"] }

filled_activity <- activity
filled_activity$steps[is.na(filled_activity$steps)] <- 
  sapply(filled_activity$interval[is.na(filled_activity$steps)], get_interval_mean)

filled_totals <- aggregate(activity$steps, list(Day = activity$date), sum, na.rm = TRUE)
hist(filled_totals$x, main = "Histogram of total steps per day")
mean_steps <- mean(filled_totals$x)
median_steps <- median(filled_totals$x)
```


## Are there differences in activity patterns between weekdays and weekends?

```{r weekends}
# Create factor variable describing weekend/weekday status of data.
weekend_days <- c("Saturday", "Sunday")
filled_activity$day_type <- as.factor(
  ifelse(weekdays(as.Date(filled_activity$date)) %in% weekend_days, "weekend", "weekday")
)

# Aggregate data to summarise interval means by weekend/weekday status.
filled_interval_means <- aggregate(
  filled_activity$steps, 
  list(interval = filled_activity$interval, day_type = filled_activity$day_type), 
  mean
)

# Plot summarised data.
ggplot(data = filled_interval_means, aes(x=interval, y=x)) + 
  geom_line() + 
  facet_grid(day_type ~ .) + 
  xlab("Interval") + 
  ylab("Mean steps") + 
  ggtitle("Mean steps per 5-minute interval")

```